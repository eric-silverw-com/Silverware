OBJECT Page 403 Purchase Order Statistics
{
  OBJECT-PROPERTIES
  {
    Date=09/19/18;
    Time=12:00:00 PM;
    Version List=NAVW113.00;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Purchase Order Statistics;
               ESM=Estad. pedido compras;
               FRC=Statistiques bon de commande;
               ENC=Purchase Order Statistics];
    InsertAllowed=No;
    DeleteAllowed=No;
    LinksAllowed=No;
    SourceTable=Table38;
    PageType=Card;
    OnOpenPage=BEGIN
                 PurchSetup.GET;
                 AllowInvDisc :=
                   NOT (PurchSetup."Calc. Inv. Discount" AND VendInvDiscRecExists("Invoice Disc. Code"));
                 AllowVATDifference :=
                   PurchSetup."Allow VAT Difference" AND
                   NOT ("Document Type" IN ["Document Type"::Quote,"Document Type"::"Blanket Order"]);
                 OnOpenPageOnBeforeSetEditable(AllowInvDisc,AllowVATDifference);
                 VATLinesFormIsEditable := AllowVATDifference OR AllowInvDisc;
                 CurrPage.EDITABLE := VATLinesFormIsEditable;
               END;

    OnAfterGetRecord=BEGIN
                       RefreshOnAfterGetRecord;
                     END;

    OnQueryClosePage=VAR
                       PurchLine@1001 : Record 39;
                       ReleasePurchaseDocument@1002 : Codeunit 415;
                     BEGIN
                       GetVATSpecification(PrevTab);
                       ReleasePurchaseDocument.CalcAndUpdateVATOnLines(Rec,PurchLine);
                       EXIT(TRUE);
                     END;

  }
  CONTROLS
  {
    { 1900000001;0;Container;
                ContainerType=ContentArea }

    { 1   ;1   ;Group     ;
                CaptionML=[ENU=General;
                           ESM=General;
                           FRC=G‚n‚ral;
                           ENC=General] }

    { 35  ;2   ;Field     ;
                Name=LineAmountGeneral;
                CaptionML=[ENU=Amount;
                           ESM=Importe;
                           FRC=Montant;
                           ENC=Amount];
                ToolTipML=[ENU=Specifies the net amount of all the lines in the purchase order. This amount does not include Tax or any invoice discount, but does include line discounts.;
                           ESM=Especifica el importe neto de todas las l¡neas del pedido de compra. No incluye IVA ni ning£n descuento en factura, aunque s¡ incluye descuentos en l¡nea.;
                           FRC=Sp‚cifie le montant net de toutes les lignes du bon de commande. Ce montant ne comprend ni la TVA ni aucun escompte facture, mais inclut les escomptes ligne.;
                           ENC=Specifies the net amount of all the lines in the purchase order. This amount does not include Tax or any invoice discount, but does include line discounts.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalPurchLine[1]."Line Amount";
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text002,FALSE);
                Editable=FALSE }

    { 32  ;2   ;Field     ;
                Name=InvDiscountAmount_General;
                CaptionML=[ENU=Inv. Discount Amount;
                           ESM=Importe dto. factura;
                           FRC=Montant d'escompte sur facture;
                           ENC=Inv. Discount Amount];
                ToolTipML=[ENU=Specifies the invoice discount amount for the entire purchase order.;
                           ESM=Especifica el importe de descuento en factura para todo el pedido de compra.;
                           FRC=Sp‚cifie le montant d'escompte de la facture pour l'ensemble du bon de commande.;
                           ENC=Specifies the invoice discount amount for the entire purchase order.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalPurchLine[1]."Inv. Discount Amount";
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                OnValidate=BEGIN
                             ActiveTab := ActiveTab::General;
                             UpdateInvDiscAmount(1);
                           END;
                            }

    { 26  ;2   ;Field     ;
                Name=Total_General;
                CaptionML=[ENU=Total;
                           ESM=Total;
                           FRC=Total;
                           ENC=Total];
                ToolTipML=[ENU=Specifies the total amount, less any invoice discount amount and excluding Tax for the purchase order.;
                           ESM=Especifica el importe total del pedido de compra, menos cualquier importe de descuento en factura y sin IVA.;
                           FRC=Sp‚cifie le montant total, hors taxes et sans escompte facture, du bon de commande.;
                           ENC=Specifies the total amount, less any invoice discount amount and excluding Tax for the purchase order.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalAmount1[1];
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text001,FALSE);
                OnValidate=BEGIN
                             ActiveTab := ActiveTab::General;
                             UpdateTotalAmount(1);
                           END;
                            }

    { 22  ;2   ;Field     ;
                CaptionML=[ENU=Tax Amount;
                           ESM=Importe IVA;
                           FRC=Montant de TVA;
                           ENC=Tax Amount];
                ToolTipML=[ENU=Specifies the total Tax amount that has been calculated for all the lines in the purchase order.;
                           ESM=Especifica el importe total del IVA que se ha calculado para todas las l¡neas del pedido de compra.;
                           FRC=Sp‚cifie le montant total de la TVA qui a ‚t‚ calcul‚ pour toutes les lignes du bon de commande.;
                           ENC=Specifies the total Tax amount that has been calculated for all the lines in the purchase order.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=VATAmount[1];
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=FORMAT(VATAmountText[1]);
                Editable=FALSE }

    { 20  ;2   ;Field     ;
                Name=TotalInclVAT_General;
                CaptionML=[ENU=Total Incl. Tax;
                           ESM=Total con IVA;
                           FRC=Total incluant taxe;
                           ENC=Total Incl. Tax];
                ToolTipML=[ENU=Specifies the amount, including Tax. On the Invoicing FastTab, this is the amount that is posted to the vendor's account for all the lines in the purchase order if you post the purchase order as invoiced.;
                           ESM=Especifica el importe total, incluido el IVA. En la ficha desplegable Facturaci¢n, ‚ste es el importe que se registra en la cuenta del proveedor para todas las l¡neas del pedido de compra si lo registra como facturado.;
                           FRC=Sp‚cifie le montant TTC. Sur le raccourci Facturation, il s'agit du montant report‚ sur le compte du fournisseur pour toutes les lignes du bon de commande si celui-ci est report‚ comme ‚tant factur‚.;
                           ENC=Specifies the amount, including Tax. On the Invoicing FastTab, this is the amount that is posted to the vendor's account for all the lines in the purchase order if you post the purchase order as invoiced.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalAmount2[1];
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text001,TRUE);
                Editable=FALSE }

    { 16  ;2   ;Field     ;
                CaptionML=[ENU=Purchase ($);
                           ESM=Compra ($);
                           FRC=Achat ($);
                           ENC=Purchase ($)];
                ToolTipML=[ENU=Specifies the amount in the Total field, converted to $.;
                           ESM=Especifica el importe que figura en el campo Total, convertido a $.;
                           FRC=Sp‚cifie le montant du champ Total, converti en $.;
                           ENC=Specifies the amount in the Total field, converted to $.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalPurchLineLCY[1].Amount;
                AutoFormatType=1;
                Editable=FALSE }

    { 37  ;2   ;Field     ;
                Name=Quantity_General;
                CaptionML=[ENU=Quantity;
                           ESM=Cantidad;
                           FRC=Quantit‚;
                           ENC=Quantity];
                ToolTipML=[ENU=Specifies the total quantity of G/L account entries, fixed assets, and/or items in the purchase order.;
                           ESM=Especifica la cantidad total de movimientos de contabilidad, activos fijos o productos que figuran en el pedido de compra.;
                           FRC=Sp‚cifie la quantit‚ totale des ‚critures GL, immobilisations et/ou articles du bon de commande.;
                           ENC=Specifies the total quantity of G/L account entries, fixed assets, and/or items in the purchase order.];
                ApplicationArea=#Basic,#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[1].Quantity;
                Editable=FALSE }

    { 30  ;2   ;Field     ;
                CaptionML=[ENU=Parcels;
                           ESM=Lotes;
                           FRC=Colis;
                           ENC=Parcels];
                ToolTipML=[ENU=Specifies the total number of parcels in the purchase order.;
                           ESM=Especifica el n£mero total de lotes del pedido de compra.;
                           FRC=Sp‚cifie le nombre total de colis du bon de commande.;
                           ENC=Specifies the total number of parcels in the purchase order.];
                ApplicationArea=#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[1]."Units per Parcel";
                Editable=FALSE }

    { 28  ;2   ;Field     ;
                CaptionML=[ENU=Net Weight;
                           ESM=Peso neto;
                           FRC=Poids net;
                           ENC=Net Weight];
                ToolTipML=[ENU=Specifies the total net weight of the items in the purchase order.;
                           ESM=Especifica el peso neto total de los productos que figuran en el pedido de compra.;
                           FRC=Sp‚cifie le poids net total des articles du bon de commande.;
                           ENC=Specifies the total net weight of the items in the purchase order.];
                ApplicationArea=#Basic,#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[1]."Net Weight";
                Editable=FALSE }

    { 23  ;2   ;Field     ;
                CaptionML=[ENU=Gross Weight;
                           ESM=Peso bruto;
                           FRC=Poids brut;
                           ENC=Gross Weight];
                ToolTipML=[ENU=Specifies the total gross weight of the items in the purchase order.;
                           ESM=Especifica el peso bruto total de los productos que figuran en el pedido de compra.;
                           FRC=Sp‚cifie le poids brut total des articles du bon de commande.;
                           ENC=Specifies the total gross weight of the items in the purchase order.];
                ApplicationArea=#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[1]."Gross Weight";
                Editable=FALSE }

    { 18  ;2   ;Field     ;
                CaptionML=[ENU=Volume;
                           ESM=Volumen;
                           FRC=Volume;
                           ENC=Volume];
                ToolTipML=[ENU=Specifies the total volume of the items in the purchase order.;
                           ESM=Especifica el volumen total de los productos que figuran en el pedido de compra.;
                           FRC=Sp‚cifie le volume total des articles du bon de commande.;
                           ENC=Specifies the total volume of the items in the purchase order.];
                ApplicationArea=#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[1]."Unit Volume";
                Editable=FALSE }

    { 40  ;2   ;Field     ;
                Name=NoOfVATLines_General;
                DrillDown=Yes;
                CaptionML=[ENU=No. of Tax Lines;
                           ESM=N.§ de l¡neas de impuestos;
                           FRC=Nbre de lignes fiscales;
                           ENC=No. of Tax Lines];
                ToolTipML=[ENU=Specifies the number of lines on the purchase order that have Tax amounts.;
                           ESM=Especifica el n£mero de l¡neas en el pedido de compra que tienen importes de IVA.;
                           FRC=Sp‚cifie le nombre de lignes sur le bon de commande qui ont des montants de TVA.;
                           ENC=Specifies the number of lines on the purchase order that have Tax amounts.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TempVATAmountLine1.COUNT;
                OnDrillDown=BEGIN
                              VATLinesDrillDown(TempVATAmountLine1,FALSE);
                              UpdateHeaderInfo(1,TempVATAmountLine1);
                            END;
                             }

    { 1905885101;1;Group  ;
                CaptionML=[ENU=Invoicing;
                           ESM=Facturaci¢n;
                           FRC=Facturation;
                           ENC=Invoicing] }

    { 59  ;2   ;Field     ;
                CaptionML=[ENU=Amount;
                           ESM=Importe;
                           FRC=Montant;
                           ENC=Amount];
                ToolTipML=[ENU=Specifies the net amount of all the lines in the purchase order. This amount does not include Tax or any invoice discount, but does include line discounts.;
                           ESM=Especifica el importe neto de todas las l¡neas del pedido de compra. No incluye IVA ni ning£n descuento en factura, aunque s¡ incluye descuentos en l¡nea.;
                           FRC=Sp‚cifie le montant net de toutes les lignes du bon de commande. Ce montant ne comprend ni la TVA ni aucun escompte facture, mais inclut les escomptes ligne.;
                           ENC=Specifies the net amount of all the lines in the purchase order. This amount does not include Tax or any invoice discount, but does include line discounts.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalPurchLine[2]."Line Amount";
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text002,FALSE);
                Editable=FALSE }

    { 57  ;2   ;Field     ;
                Name=InvDiscountAmount_Invoicing;
                CaptionML=[ENU=Inv. Discount Amount;
                           ESM=Importe dto. factura;
                           FRC=Montant d'escompte sur facture;
                           ENC=Inv. Discount Amount];
                ToolTipML=[ENU=Specifies the invoice discount amount.;
                           ESM=Especifica el importe de descuento en factura.;
                           FRC=Sp‚cifie le montant d'escompte de la facture.;
                           ENC=Specifies the invoice discount amount.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalPurchLine[2]."Inv. Discount Amount";
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                OnValidate=BEGIN
                             ActiveTab := ActiveTab::Invoicing;
                             UpdateInvDiscAmount(2);
                           END;
                            }

    { 51  ;2   ;Field     ;
                Name=Total_Invoicing;
                CaptionML=[ENU=Total;
                           ESM=Total;
                           FRC=Total;
                           ENC=Total];
                ToolTipML=[ENU=Specifies the total amount less any invoice discount amount and excluding Tax for the purchase order.;
                           ESM=Especifica el importe total del pedido de compra menos cualquier importe de descuento en factura y sin IVA.;
                           FRC=Sp‚cifie le montant total, hors taxes et sans escompte facture, du bon de commande.;
                           ENC=Specifies the total amount less any invoice discount amount and excluding Tax for the purchase order.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalAmount1[2];
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text001,FALSE);
                OnValidate=BEGIN
                             ActiveTab := ActiveTab::Invoicing;
                             UpdateTotalAmount(2);
                           END;
                            }

    { 47  ;2   ;Field     ;
                Name=VATAmount_Invoicing;
                CaptionML=[ENU=Tax Amount;
                           ESM=Importe IVA;
                           FRC=Montant de TVA;
                           ENC=Tax Amount];
                ToolTipML=[ENU=Specifies the total Tax amount that has been calculated for all the lines in the purchase order.;
                           ESM=Especifica el importe total del IVA que se ha calculado para todas las l¡neas del pedido de compra.;
                           FRC=Sp‚cifie le montant total de la TVA qui a ‚t‚ calcul‚ pour toutes les lignes du bon de commande.;
                           ENC=Specifies the total Tax amount that has been calculated for all the lines in the purchase order.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=VATAmount[2];
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=FORMAT(VATAmountText[2]);
                Editable=FALSE }

    { 45  ;2   ;Field     ;
                Name=TotalInclVAT_Invoicing;
                CaptionML=[ENU=Total Incl. Tax;
                           ESM=Total con IVA;
                           FRC=Total incluant taxe;
                           ENC=Total Incl. Tax];
                ToolTipML=[ENU=Specifies the amount, including Tax. On the Invoicing FastTab, this is the amount that is posted to the vendor's account for all the lines in the purchase order if you post the purchase order as invoiced.;
                           ESM=Especifica el importe total, incluido el IVA. En la ficha desplegable Facturaci¢n, ‚ste es el importe que se registra en la cuenta del proveedor para todas las l¡neas del pedido de compra si lo registra como facturado.;
                           FRC=Sp‚cifie le montant TTC. Sur le raccourci Facturation, il s'agit du montant report‚ sur le compte du fournisseur pour toutes les lignes du bon de commande si celui-ci est report‚ comme ‚tant factur‚.;
                           ENC=Specifies the amount, including Tax. On the Invoicing FastTab, this is the amount that is posted to the vendor's account for all the lines in the purchase order if you post the purchase order as invoiced.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalAmount2[2];
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text001,TRUE);
                Editable=FALSE }

    { 41  ;2   ;Field     ;
                CaptionML=[ENU=Purchase ($);
                           ESM=Compra ($);
                           FRC=Achat ($);
                           ENC=Purchase ($)];
                ToolTipML=[ENU=Specifies the amount in the Total field, converted to $.;
                           ESM=Especifica el importe que figura en el campo Total, convertido a $.;
                           FRC=Sp‚cifie le montant du champ Total, converti en $.;
                           ENC=Specifies the amount in the Total field, converted to $.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalPurchLineLCY[2].Amount;
                AutoFormatType=1;
                Editable=FALSE }

    { 61  ;2   ;Field     ;
                Name=Quantity_Invoicing;
                CaptionML=[ENU=Quantity;
                           ESM=Cantidad;
                           FRC=Quantit‚;
                           ENC=Quantity];
                ToolTipML=[ENU=Specifies the total quantity of G/L account entries, fixed assets, and/or items in the purchase order.;
                           ESM=Especifica la cantidad total de movimientos de contabilidad, activos fijos o productos que figuran en el pedido de compra.;
                           FRC=Sp‚cifie la quantit‚ totale des ‚critures GL, immobilisations et/ou articles du bon de commande.;
                           ENC=Specifies the total quantity of G/L account entries, fixed assets, and/or items in the purchase order.];
                ApplicationArea=#Basic,#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[2].Quantity;
                Editable=FALSE }

    { 55  ;2   ;Field     ;
                CaptionML=[ENU=Parcels;
                           ESM=Lotes;
                           FRC=Colis;
                           ENC=Parcels];
                ToolTipML=[ENU=Specifies the total number of parcels in the purchase order.;
                           ESM=Especifica el n£mero total de lotes del pedido de compra.;
                           FRC=Sp‚cifie le nombre total de colis du bon de commande.;
                           ENC=Specifies the total number of parcels in the purchase order.];
                ApplicationArea=#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[2]."Units per Parcel";
                Editable=FALSE }

    { 53  ;2   ;Field     ;
                CaptionML=[ENU=Net Weight;
                           ESM=Peso neto;
                           FRC=Poids net;
                           ENC=Net Weight];
                ToolTipML=[ENU=Specifies the total net weight of the items in the purchase order.;
                           ESM=Especifica el peso neto total de los productos que figuran en el pedido de compra.;
                           FRC=Sp‚cifie le poids net total des articles du bon de commande.;
                           ENC=Specifies the total net weight of the items in the purchase order.];
                ApplicationArea=#Basic,#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[2]."Net Weight";
                Editable=FALSE }

    { 48  ;2   ;Field     ;
                CaptionML=[ENU=Gross Weight;
                           ESM=Peso bruto;
                           FRC=Poids brut;
                           ENC=Gross Weight];
                ToolTipML=[ENU=Specifies the total gross weight of the items in the purchase order.;
                           ESM=Especifica el peso bruto total de los productos que figuran en el pedido de compra.;
                           FRC=Sp‚cifie le poids brut total des articles du bon de commande.;
                           ENC=Specifies the total gross weight of the items in the purchase order.];
                ApplicationArea=#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[2]."Gross Weight";
                Editable=FALSE }

    { 43  ;2   ;Field     ;
                CaptionML=[ENU=Volume;
                           ESM=Volumen;
                           FRC=Volume;
                           ENC=Volume];
                ToolTipML=[ENU=Specifies the total volume of the items in the purchase order.;
                           ESM=Especifica el volumen total de los productos que figuran en el pedido de compra.;
                           FRC=Sp‚cifie le volume total des articles du bon de commande.;
                           ENC=Specifies the total volume of the items in the purchase order.];
                ApplicationArea=#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[2]."Unit Volume";
                Editable=FALSE }

    { 64  ;2   ;Field     ;
                Name=NoOfVATLines_Invoicing;
                DrillDown=Yes;
                CaptionML=[ENU=No. of Tax Lines;
                           ESM=N.§ de l¡neas de impuestos;
                           FRC=Nbre de lignes fiscales;
                           ENC=No. of Tax Lines];
                ToolTipML=[ENU=Specifies the number of lines on the purchase order that have Tax amounts.;
                           ESM=Especifica el n£mero de l¡neas en el pedido de compra que tienen importes de IVA.;
                           FRC=Sp‚cifie le nombre de lignes sur le bon de commande qui ont des montants de TVA.;
                           ENC=Specifies the number of lines on the purchase order that have Tax amounts.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TempVATAmountLine2.COUNT;
                OnDrillDown=BEGIN
                              ActiveTab := ActiveTab::Invoicing;
                              VATLinesDrillDown(TempVATAmountLine2,TRUE);
                              UpdateHeaderInfo(2,TempVATAmountLine2);

                              IF TempVATAmountLine2.GetAnyLineModified THEN BEGIN
                                UpdateVATOnPurchLines;
                                RefreshOnAfterGetRecord;
                              END;
                            END;
                             }

    { 1906801201;1;Group  ;
                CaptionML=[ENU=Shipping;
                           ESM=Env¡o;
                           FRC=Livraison;
                           ENC=Shipping] }

    { 83  ;2   ;Field     ;
                CaptionML=[ENU=Amount;
                           ESM=Importe;
                           FRC=Montant;
                           ENC=Amount];
                ToolTipML=[ENU=Specifies the net amount of all the lines in the purchase order. This amount does not include Tax or any invoice discount, but does include line discounts.;
                           ESM=Especifica el importe neto de todas las l¡neas del pedido de compra. No incluye IVA ni ning£n descuento en factura, aunque s¡ incluye descuentos en l¡nea.;
                           FRC=Sp‚cifie le montant net de toutes les lignes du bon de commande. Ce montant ne comprend ni la TVA ni aucun escompte facture, mais inclut les escomptes ligne.;
                           ENC=Specifies the net amount of all the lines in the purchase order. This amount does not include Tax or any invoice discount, but does include line discounts.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalPurchLine[3]."Line Amount";
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text002,FALSE);
                Editable=FALSE }

    { 81  ;2   ;Field     ;
                CaptionML=[ENU=Inv. Discount Amount;
                           ESM=Importe dto. factura;
                           FRC=Montant d'escompte sur facture;
                           ENC=Inv. Discount Amount];
                ToolTipML=[ENU=Specifies the invoice discount amount for the entire purchase order.;
                           ESM=Especifica el importe de descuento en factura para todo el pedido de compra.;
                           FRC=Sp‚cifie le montant d'escompte de la facture pour l'ensemble du bon de commande.;
                           ENC=Specifies the invoice discount amount for the entire purchase order.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalPurchLine[3]."Inv. Discount Amount";
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                Editable=FALSE }

    { 75  ;2   ;Field     ;
                CaptionML=[ENU=Total;
                           ESM=Total;
                           FRC=Total;
                           ENC=Total];
                ToolTipML=[ENU=Specifies the total amount less any invoice discount amount and excluding Tax for the purchase order.;
                           ESM=Especifica el importe total del pedido de compra menos cualquier importe de descuento en factura y sin IVA.;
                           FRC=Sp‚cifie le montant total, hors taxes et sans escompte facture, du bon de commande.;
                           ENC=Specifies the total amount less any invoice discount amount and excluding Tax for the purchase order.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalAmount1[3];
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text001,FALSE);
                Editable=FALSE }

    { 71  ;2   ;Field     ;
                CaptionML=[ENU=Tax Amount;
                           ESM=Importe IVA;
                           FRC=Montant de TVA;
                           ENC=Tax Amount];
                ToolTipML=[ENU=Specifies the total Tax amount that has been calculated for all the lines in the purchase order.;
                           ESM=Especifica el importe total del IVA que se ha calculado para todas las l¡neas del pedido de compra.;
                           FRC=Sp‚cifie le montant total de la TVA qui a ‚t‚ calcul‚ pour toutes les lignes du bon de commande.;
                           ENC=Specifies the total Tax amount that has been calculated for all the lines in the purchase order.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=VATAmount[3];
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=FORMAT(VATAmountText[3]);
                Editable=FALSE }

    { 69  ;2   ;Field     ;
                Name=TotalInclVAT_Shipping;
                CaptionML=[ENU=Total Incl. Tax;
                           ESM=Total con IVA;
                           FRC=Total incluant taxe;
                           ENC=Total Incl. Tax];
                ToolTipML=[ENU=Specifies the amount, including Tax. On the Invoicing FastTab, this is the amount that is posted to the vendor's account for all the lines in the purchase order if you post the purchase order as invoiced.;
                           ESM=Especifica el importe total, incluido el IVA. En la ficha desplegable Facturaci¢n, ‚ste es el importe que se registra en la cuenta del proveedor para todas las l¡neas del pedido de compra si lo registra como facturado.;
                           FRC=Sp‚cifie le montant TTC. Sur le raccourci Facturation, il s'agit du montant report‚ sur le compte du fournisseur pour toutes les lignes du bon de commande si celui-ci est report‚ comme ‚tant factur‚.;
                           ENC=Specifies the amount, including Tax. On the Invoicing FastTab, this is the amount that is posted to the vendor's account for all the lines in the purchase order if you post the purchase order as invoiced.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalAmount2[3];
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text001,TRUE);
                Editable=FALSE }

    { 65  ;2   ;Field     ;
                CaptionML=[ENU=Purchase ($);
                           ESM=Compra ($);
                           FRC=Achat ($);
                           ENC=Purchase ($)];
                ToolTipML=[ENU=Specifies the amount in the Total field, converted to $.;
                           ESM=Especifica el importe que figura en el campo Total, convertido a $.;
                           FRC=Sp‚cifie le montant du champ Total, converti en $.;
                           ENC=Specifies the amount in the Total field, converted to $.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TotalPurchLineLCY[3].Amount;
                AutoFormatType=1;
                Editable=FALSE }

    { 85  ;2   ;Field     ;
                Name=Quantity_Shipping;
                CaptionML=[ENU=Quantity;
                           ESM=Cantidad;
                           FRC=Quantit‚;
                           ENC=Quantity];
                ToolTipML=[ENU=Specifies the total quantity of G/L account entries, fixed assets, and/or items in the purchase order.;
                           ESM=Especifica la cantidad total de movimientos de contabilidad, activos fijos o productos que figuran en el pedido de compra.;
                           FRC=Sp‚cifie la quantit‚ totale des ‚critures GL, immobilisations et/ou articles du bon de commande.;
                           ENC=Specifies the total quantity of G/L account entries, fixed assets, and/or items in the purchase order.];
                ApplicationArea=#Basic,#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[3].Quantity;
                Editable=FALSE }

    { 79  ;2   ;Field     ;
                CaptionML=[ENU=Parcels;
                           ESM=Lotes;
                           FRC=Colis;
                           ENC=Parcels];
                ToolTipML=[ENU=Specifies the total number of parcels in the purchase order.;
                           ESM=Especifica el n£mero total de lotes del pedido de compra.;
                           FRC=Sp‚cifie le nombre total de colis du bon de commande.;
                           ENC=Specifies the total number of parcels in the purchase order.];
                ApplicationArea=#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[3]."Units per Parcel";
                Editable=FALSE }

    { 77  ;2   ;Field     ;
                CaptionML=[ENU=Net Weight;
                           ESM=Peso neto;
                           FRC=Poids net;
                           ENC=Net Weight];
                ToolTipML=[ENU=Specifies the total net weight of the items in the purchase order.;
                           ESM=Especifica el peso neto total de los productos que figuran en el pedido de compra.;
                           FRC=Sp‚cifie le poids net total des articles du bon de commande.;
                           ENC=Specifies the total net weight of the items in the purchase order.];
                ApplicationArea=#Basic,#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[3]."Net Weight";
                Editable=FALSE }

    { 72  ;2   ;Field     ;
                CaptionML=[ENU=Gross Weight;
                           ESM=Peso bruto;
                           FRC=Poids brut;
                           ENC=Gross Weight];
                ToolTipML=[ENU=Specifies the total gross weight of the items in the purchase order.;
                           ESM=Especifica el peso bruto total de los productos que figuran en el pedido de compra.;
                           FRC=Sp‚cifie le poids brut total des articles du bon de commande.;
                           ENC=Specifies the total gross weight of the items in the purchase order.];
                ApplicationArea=#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[3]."Gross Weight";
                Editable=FALSE }

    { 67  ;2   ;Field     ;
                CaptionML=[ENU=Volume;
                           ESM=Volumen;
                           FRC=Volume;
                           ENC=Volume];
                ToolTipML=[ENU=Specifies the total volume of the items in the purchase order.;
                           ESM=Especifica el volumen total de los productos que figuran en el pedido de compra.;
                           FRC=Sp‚cifie le volume total des articles du bon de commande.;
                           ENC=Specifies the total volume of the items in the purchase order.];
                ApplicationArea=#Suite;
                DecimalPlaces=0:5;
                SourceExpr=TotalPurchLine[3]."Unit Volume";
                Editable=FALSE }

    { 88  ;2   ;Field     ;
                DrillDown=Yes;
                CaptionML=[ENU=No. of Tax Lines;
                           ESM=N.§ de l¡neas de impuestos;
                           FRC=Nbre de lignes fiscales;
                           ENC=No. of Tax Lines];
                ToolTipML=[ENU=Specifies the number of lines on the purchase order that have Tax amounts.;
                           ESM=Especifica el n£mero de l¡neas en el pedido de compra que tienen importes de IVA.;
                           FRC=Sp‚cifie le nombre de lignes sur le bon de commande qui ont des montants de TVA.;
                           ENC=Specifies the number of lines on the purchase order that have Tax amounts.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=TempVATAmountLine3.COUNT;
                OnDrillDown=BEGIN
                              VATLinesDrillDown(TempVATAmountLine3,FALSE);
                            END;
                             }

    { 1900201301;1;Group  ;
                CaptionML=[ENU=Prepayment;
                           ESM=Anticipo;
                           FRC=Paiement anticip‚;
                           ENC=Prepayment] }

    { 15  ;2   ;Field     ;
                Name=PrepmtTotalAmount;
                ApplicationArea=#Prepayments;
                SourceExpr=PrepmtTotalAmount;
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text006,FALSE);
                OnValidate=BEGIN
                             ActiveTab := ActiveTab::Prepayment;
                             UpdatePrepmtAmount;
                           END;
                            }

    { 13  ;2   ;Field     ;
                CaptionML=[ENU=Prepayment Amount Invoiced;
                           ESM=Importe anticipo facturado;
                           FRC=Montant de paiement anticip‚ factur‚;
                           ENC=Prepayment Amount Invoiced];
                ToolTipML=[ENU=Specifies the total prepayment amount that has been invoiced for the order.;
                           ESM=Especifica el importe de anticipo total facturado para el pedido.;
                           FRC=Sp‚cifie le montant de paiement anticip‚ total factur‚ pour la commande.;
                           ENC=Specifies the total prepayment amount that has been invoiced for the order.];
                ApplicationArea=#Prepayments;
                SourceExpr=PrepmtVATAmount;
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=FORMAT(PrepmtVATAmountText);
                Editable=FALSE }

    { 8   ;2   ;Field     ;
                CaptionML=[ENU=Prepmt. Amount Invoiced;
                           ESM=Importe anticipo facturado;
                           FRC=Montant paiem. ant. factur‚;
                           ENC=Prepmt. Amount Invoiced];
                ToolTipML=[ENU=Specifies the total prepayment amount that has been invoiced for the order.;
                           ESM=Especifica el importe de anticipo total facturado para el pedido.;
                           FRC=Sp‚cifie le montant de paiement anticip‚ total factur‚ pour la commande.;
                           ENC=Specifies the total prepayment amount that has been invoiced for the order.];
                ApplicationArea=#Prepayments;
                SourceExpr=PrepmtTotalAmount2;
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text006,TRUE);
                Editable=FALSE }

    { 6   ;2   ;Field     ;
                ApplicationArea=#Prepayments;
                SourceExpr=TotalPurchLine[1]."Prepmt. Amt. Inv.";
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text007,FALSE);
                Editable=FALSE }

    { 7   ;2   ;Field     ;
                ExtendedDatatype=Ratio;
                CaptionML=[ENU=Invoiced % of Prepayment Amt.;
                           ESM=% facturado de importe anticipo;
                           FRC=% factur‚ sur montant de paiement anticip‚;
                           ENC=Invoiced % of Prepayment Amt.];
                ToolTipML=[ENU=Specifies the invoiced percentage of the prepayment amount.;
                           ESM=Especifica el porcentaje facturado del importe anticipo.;
                           FRC=Sp‚cifie le pourcentage factur‚ du montant paiement anticip‚.;
                           ENC=Specifies the invoiced percentage of the prepayment amount.];
                ApplicationArea=#Prepayments;
                SourceExpr=PrepmtInvPct }

    { 5   ;2   ;Field     ;
                ApplicationArea=#Prepayments;
                SourceExpr=TotalPurchLine[1]."Prepmt Amt Deducted";
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text008,FALSE);
                Editable=FALSE }

    { 3   ;2   ;Field     ;
                ExtendedDatatype=Ratio;
                CaptionML=[ENU=Deducted % of Prepayment Amt. to Deduct;
                           ESM=% descontado del importe anticipo que se debe descontar;
                           FRC=% d‚duit sur montant de paiement anticip‚ … d‚duire;
                           ENC=Deducted % of Prepayment Amt. to Deduct];
                ToolTipML=[ENU=Specifies the deducted percentage of the prepayment amount to deduct.;
                           ESM=Especifica el porcentaje deducido del importe anticipo que se va a deducir.;
                           FRC=Sp‚cifie le pourcentage d‚duit du montant paiement anticip‚ … d‚duire.;
                           ENC=Specifies the deducted percentage of the prepayment amount to deduct.];
                ApplicationArea=#Prepayments;
                SourceExpr=PrepmtDeductedPct }

    { 4   ;2   ;Field     ;
                ApplicationArea=#Prepayments;
                SourceExpr=TotalPurchLine[1]."Prepmt Amt to Deduct";
                AutoFormatType=1;
                AutoFormatExpr="Currency Code";
                CaptionClass=GetCaptionClass(Text009,FALSE);
                Editable=FALSE }

    { 90  ;2   ;Field     ;
                DrillDown=Yes;
                CaptionML=[ENU=No. of VAT Lines;
                           ESM=N§ de l¡neas de IVA;
                           FRC=Nombre de lignes TVA;
                           ENC=No. of Tax Lines];
                ToolTipML=[ENU=Specifies the number of purchase order lines that are associated with the Tax ledger line.;
                           ESM=Especifica el n£mero de l¡neas de pedido de compra asociadas a la l¡nea de movimientos de IVA.;
                           FRC=Sp‚cifie le nombre de lignes du bon de commande qui sont associ‚es … la ligne du livre TVA.;
                           ENC=Specifies the number of purchase order lines that are associated with the Tax ledger line.];
                ApplicationArea=#Suite;
                SourceExpr=TempVATAmountLine4.COUNT;
                OnDrillDown=BEGIN
                              VATLinesDrillDown(TempVATAmountLine4,TRUE);
                            END;
                             }

    { 1901061301;1;Group  ;
                CaptionML=[ENU=Vendor;
                           ESM=Proveedor;
                           FRC=Fournisseur;
                           ENC=Vendor] }

    { 131 ;2   ;Field     ;
                CaptionML=[ENU=Balance ($);
                           ESM=Saldo ($);
                           FRC=Solde ($);
                           ENC=Balance ($)];
                ToolTipML=[ENU=Specifies the balance (in $) due to the vendor.;
                           ESM=Especifica el saldo adeudado (en $) al proveedor.;
                           FRC=Sp‚cifie le solde (dans la devise soci‚t‚) d– au fournisseur.;
                           ENC=Specifies the balance (in $) due to the vendor.];
                ApplicationArea=#Suite;
                SourceExpr=Vend."Balance (LCY)";
                AutoFormatType=1;
                Editable=FALSE }

  }
  CODE
  {
    VAR
      Text000@1000 : TextConst 'ENU=Purchase %1 Statistics;ESM=Estad¡sticas %1 compras;FRC=Statistiques %1 achat;ENC=Purchase %1 Statistics';
      Text001@1001 : TextConst 'ENU=Total;ESM=Total;FRC=Total;ENC=Total';
      Text002@1002 : TextConst 'ENU=Amount;ESM=Importe;FRC=Montant;ENC=Amount';
      Text003@1003 : TextConst 'ENU=%1 must not be 0.;ESM=%1 no debe ser 0.;FRC=%1 ne doit pas ˆtre 0.;ENC=%1 must not be 0.';
      Text004@1004 : TextConst 'ENU=%1 must not be greater than %2.;ESM=%1 no debe ser m s grande que %2;FRC=%1 ne doit pas ˆtre sup‚rieur(e) … %2.;ENC=%1 must not be greater than %2.';
      Text005@1005 : TextConst 'ENU=You cannot change the invoice discount because there is a %1 record for %2 %3.;ESM=No puede cambiar el dto. factura porque hay un %1 registro para %2 %3.;FRC=Vous ne pouvez pas modifier l''escompte de la facture car il existe un enregistrement %1 pour %2 %3.;ENC=You cannot change the invoice discount because there is a %1 record for %2 %3.';
      TotalPurchLine@1006 : ARRAY [3] OF Record 39;
      TotalPurchLineLCY@1007 : ARRAY [3] OF Record 39;
      Vend@1008 : Record 23;
      TempVATAmountLine1@1009 : TEMPORARY Record 290;
      TempVATAmountLine2@1010 : TEMPORARY Record 290;
      TempVATAmountLine3@1011 : TEMPORARY Record 290;
      TempVATAmountLine4@1030 : TEMPORARY Record 290;
      PurchSetup@1012 : Record 312;
      PurchPost@1013 : Codeunit 90;
      VATLinesForm@1037 : Page 9401;
      TotalAmount1@1014 : ARRAY [3] OF Decimal;
      TotalAmount2@1015 : ARRAY [3] OF Decimal;
      VATAmount@1016 : ARRAY [3] OF Decimal;
      PrepmtTotalAmount@1028 : Decimal;
      PrepmtVATAmount@1027 : Decimal;
      PrepmtTotalAmount2@1026 : Decimal;
      VATAmountText@1017 : ARRAY [3] OF Text[30];
      PrepmtVATAmountText@1029 : Text[30];
      PrepmtInvPct@1032 : Decimal;
      PrepmtDeductedPct@1031 : Decimal;
      i@1018 : Integer;
      PrevNo@1019 : Code[20];
      ActiveTab@1020 : 'General,Invoicing,Shipping,Prepayment';
      PrevTab@1021 : 'General,Invoicing,Shipping,Prepayment';
      VATLinesFormIsEditable@1023 : Boolean;
      AllowInvDisc@1024 : Boolean;
      AllowVATDifference@1025 : Boolean;
      Text006@1033 : TextConst 'ENU=Prepmt. Amount;ESM=Importe anticipo;FRC=Montant de paiement anticip‚;ENC=Prepmt. Amount';
      Text007@1034 : TextConst 'ENU=Prepmt. Amt. Invoiced;ESM=Importe anticipo facturado;FRC=Montant de paiement anticip‚ factur‚;ENC=Prepmt. Amt. Invoiced';
      Text008@1035 : TextConst 'ENU=Prepmt. Amt. Deducted;ESM=Importe anticipo descontado;FRC=Montant de paiement anticip‚ d‚duit;ENC=Prepmt. Amt. Deducted';
      Text009@1036 : TextConst 'ENU=Prepmt. Amt. to Deduct;ESM=Importe anticipo para descontar;FRC=Montant de paiement anticip‚ … d‚duire;ENC=Prepmt. Amt. to Deduct';
      UpdateInvDiscountQst@1022 : TextConst 'ENU=One or more lines have been invoiced. The discount distributed to invoiced lines will not be taken into account.\\Do you want to update the invoice discount?;ESM=Se han facturado una o varias l¡neas. No se tendr  en cuenta el descuento distribuido entre las l¡neas facturadas.\\¨Desea actualizar el descuento en factura?;FRC=Une ou plusieurs lignes ont ‚t‚ factur‚es. L''escompte r‚parti sur les lignes factur‚es n''est pas pris en compte.\\Voulez-vous mettre … jour l''escompte facture?;ENC=One or more lines have been invoiced. The discount distributed to invoiced lines will not be taken into account.\\Do you want to update the invoice discount?';

    LOCAL PROCEDURE RefreshOnAfterGetRecord@11();
    VAR
      PurchLine@1003 : Record 39;
      TempPurchLine@1002 : TEMPORARY Record 39;
      PurchPostPrepayments@1001 : Codeunit 444;
    BEGIN
      CurrPage.CAPTION(STRSUBSTNO(Text000,"Document Type"));

      IF PrevNo = "No." THEN
        EXIT;
      PrevNo := "No.";
      FILTERGROUP(2);
      SETRANGE("No.",PrevNo);
      FILTERGROUP(0);

      CLEAR(PurchLine);
      CLEAR(TotalPurchLine);
      CLEAR(TotalPurchLineLCY);

      FOR i := 1 TO 3 DO BEGIN
        TempPurchLine.DELETEALL;
        CLEAR(TempPurchLine);
        CLEAR(PurchPost);
        PurchPost.GetPurchLines(Rec,TempPurchLine,i - 1);
        CLEAR(PurchPost);
        CASE i OF
          1:
            PurchLine.CalcVATAmountLines(0,Rec,TempPurchLine,TempVATAmountLine1);
          2:
            PurchLine.CalcVATAmountLines(0,Rec,TempPurchLine,TempVATAmountLine2);
          3:
            PurchLine.CalcVATAmountLines(0,Rec,TempPurchLine,TempVATAmountLine3);
        END;

        PurchPost.SumPurchLinesTemp(
          Rec,TempPurchLine,i - 1,TotalPurchLine[i],TotalPurchLineLCY[i],
          VATAmount[i],VATAmountText[i]);
        IF "Prices Including VAT" THEN BEGIN
          TotalAmount2[i] := TotalPurchLine[i].Amount;
          TotalAmount1[i] := TotalAmount2[i] + VATAmount[i];
          TotalPurchLine[i]."Line Amount" := TotalAmount1[i] + TotalPurchLine[i]."Inv. Discount Amount";
        END ELSE BEGIN
          TotalAmount1[i] := TotalPurchLine[i].Amount;
          TotalAmount2[i] := TotalPurchLine[i]."Amount Including VAT";
        END;
      END;
      TempPurchLine.DELETEALL;
      CLEAR(TempPurchLine);
      PurchPostPrepayments.GetPurchLines(Rec,0,TempPurchLine);
      PurchPostPrepayments.SumPrepmt(
        Rec,TempPurchLine,TempVATAmountLine4,PrepmtTotalAmount,PrepmtVATAmount,PrepmtVATAmountText);
      PrepmtInvPct :=
        Pct(TotalPurchLine[1]."Prepmt. Amt. Inv.",PrepmtTotalAmount);
      PrepmtDeductedPct :=
        Pct(TotalPurchLine[1]."Prepmt Amt Deducted",TotalPurchLine[1]."Prepmt. Amt. Inv.");
      IF "Prices Including VAT" THEN BEGIN
        PrepmtTotalAmount2 := PrepmtTotalAmount;
        PrepmtTotalAmount := PrepmtTotalAmount + PrepmtVATAmount;
      END ELSE
        PrepmtTotalAmount2 := PrepmtTotalAmount + PrepmtVATAmount;

      IF Vend.GET("Pay-to Vendor No.") THEN
        Vend.CALCFIELDS("Balance (LCY)")
      ELSE
        CLEAR(Vend);

      TempVATAmountLine1.MODIFYALL(Modified,FALSE);
      TempVATAmountLine2.MODIFYALL(Modified,FALSE);
      TempVATAmountLine3.MODIFYALL(Modified,FALSE);
      TempVATAmountLine4.MODIFYALL(Modified,FALSE);

      PrevTab := -1;
      UpdateHeaderInfo(2,TempVATAmountLine2);
    END;

    LOCAL PROCEDURE UpdateHeaderInfo@5(IndexNo@1000 : Integer;VAR VATAmountLine@1001 : Record 290);
    VAR
      CurrExchRate@1002 : Record 330;
      UseDate@1003 : Date;
    BEGIN
      TotalPurchLine[IndexNo]."Inv. Discount Amount" := VATAmountLine.GetTotalInvDiscAmount;
      TotalAmount1[IndexNo] :=
        TotalPurchLine[IndexNo]."Line Amount" - TotalPurchLine[IndexNo]."Inv. Discount Amount";
      VATAmount[IndexNo] := VATAmountLine.GetTotalVATAmount;
      IF "Prices Including VAT" THEN BEGIN
        TotalAmount1[IndexNo] := VATAmountLine.GetTotalAmountInclVAT;
        TotalAmount2[IndexNo] := TotalAmount1[IndexNo] - VATAmount[IndexNo];
        TotalPurchLine[IndexNo]."Line Amount" :=
          TotalAmount1[IndexNo] + TotalPurchLine[IndexNo]."Inv. Discount Amount";
      END ELSE
        TotalAmount2[IndexNo] := TotalAmount1[IndexNo] + VATAmount[IndexNo];

      IF "Prices Including VAT" THEN
        TotalPurchLineLCY[IndexNo].Amount := TotalAmount2[IndexNo]
      ELSE
        TotalPurchLineLCY[IndexNo].Amount := TotalAmount1[IndexNo];
      IF "Currency Code" <> '' THEN BEGIN
        IF "Posting Date" = 0D THEN
          UseDate := WORKDATE
        ELSE
          UseDate := "Posting Date";

        TotalPurchLineLCY[IndexNo].Amount :=
          CurrExchRate.ExchangeAmtFCYToLCY(
            UseDate,"Currency Code",TotalPurchLineLCY[IndexNo].Amount,"Currency Factor");
      END;
    END;

    LOCAL PROCEDURE GetVATSpecification@21(QtyType@1000 : 'General,Invoicing,Shipping');
    BEGIN
      CASE QtyType OF
        QtyType::General:
          BEGIN
            VATLinesForm.GetTempVATAmountLine(TempVATAmountLine1);
            IF TempVATAmountLine1.GetAnyLineModified THEN
              UpdateHeaderInfo(1,TempVATAmountLine1);
          END;
        QtyType::Invoicing:
          BEGIN
            VATLinesForm.GetTempVATAmountLine(TempVATAmountLine2);
            IF TempVATAmountLine2.GetAnyLineModified THEN
              UpdateHeaderInfo(2,TempVATAmountLine2);
          END;
        QtyType::Shipping:
          VATLinesForm.GetTempVATAmountLine(TempVATAmountLine3);
      END;
    END;

    LOCAL PROCEDURE UpdateTotalAmount@16(IndexNo@1000 : Integer);
    VAR
      SaveTotalAmount@1001 : Decimal;
    BEGIN
      CheckAllowInvDisc;
      IF "Prices Including VAT" THEN BEGIN
        SaveTotalAmount := TotalAmount1[IndexNo];
        UpdateInvDiscAmount(IndexNo);
        TotalAmount1[IndexNo] := SaveTotalAmount;
      END;
      WITH TotalPurchLine[IndexNo] DO
        "Inv. Discount Amount" := "Line Amount" - TotalAmount1[IndexNo];
      UpdateInvDiscAmount(IndexNo);
    END;

    LOCAL PROCEDURE UpdateInvDiscAmount@3(ModifiedIndexNo@1000 : Integer);
    VAR
      PartialInvoicing@1001 : Boolean;
      MaxIndexNo@1002 : Integer;
      IndexNo@1003 : ARRAY [2] OF Integer;
      i@1004 : Integer;
      InvDiscBaseAmount@1005 : Decimal;
    BEGIN
      CheckAllowInvDisc;
      IF NOT (ModifiedIndexNo IN [1,2]) THEN
        EXIT;

      IF InvoicedLineExists THEN
        IF NOT CONFIRM(UpdateInvDiscountQst,FALSE) THEN
          ERROR('');

      IF ModifiedIndexNo = 1 THEN
        InvDiscBaseAmount := TempVATAmountLine1.GetTotalInvDiscBaseAmount(FALSE,"Currency Code")
      ELSE
        InvDiscBaseAmount := TempVATAmountLine2.GetTotalInvDiscBaseAmount(FALSE,"Currency Code");

      IF InvDiscBaseAmount = 0 THEN
        ERROR(Text003,TempVATAmountLine2.FIELDCAPTION("Inv. Disc. Base Amount"));

      IF TotalPurchLine[ModifiedIndexNo]."Inv. Discount Amount" / InvDiscBaseAmount > 1 THEN
        ERROR(
          Text004,
          TotalPurchLine[ModifiedIndexNo].FIELDCAPTION("Inv. Discount Amount"),
          TempVATAmountLine2.FIELDCAPTION("Inv. Disc. Base Amount"));

      PartialInvoicing := (TotalPurchLine[1]."Line Amount" <> TotalPurchLine[2]."Line Amount");

      IndexNo[1] := ModifiedIndexNo;
      IndexNo[2] := 3 - ModifiedIndexNo;
      IF (ModifiedIndexNo = 2) AND PartialInvoicing THEN
        MaxIndexNo := 1
      ELSE
        MaxIndexNo := 2;

      IF NOT PartialInvoicing THEN
        IF ModifiedIndexNo = 1 THEN
          TotalPurchLine[2]."Inv. Discount Amount" := TotalPurchLine[1]."Inv. Discount Amount"
        ELSE
          TotalPurchLine[1]."Inv. Discount Amount" := TotalPurchLine[2]."Inv. Discount Amount";

      FOR i := 1 TO MaxIndexNo DO
        WITH TotalPurchLine[IndexNo[i]] DO BEGIN
          IF (i = 1) OR NOT PartialInvoicing THEN
            IF IndexNo[i] = 1 THEN BEGIN
              TempVATAmountLine1.SetInvoiceDiscountAmount(
                "Inv. Discount Amount","Currency Code","Prices Including VAT","VAT Base Discount %");
            END ELSE
              TempVATAmountLine2.SetInvoiceDiscountAmount(
                "Inv. Discount Amount","Currency Code","Prices Including VAT","VAT Base Discount %");

          IF (i = 2) AND PartialInvoicing THEN
            IF IndexNo[i] = 1 THEN BEGIN
              InvDiscBaseAmount := TempVATAmountLine2.GetTotalInvDiscBaseAmount(FALSE,"Currency Code");
              IF InvDiscBaseAmount = 0 THEN
                TempVATAmountLine1.SetInvoiceDiscountPercent(
                  0,"Currency Code","Prices Including VAT",FALSE,"VAT Base Discount %")
              ELSE
                TempVATAmountLine1.SetInvoiceDiscountPercent(
                  100 * TempVATAmountLine2.GetTotalInvDiscAmount / InvDiscBaseAmount,
                  "Currency Code","Prices Including VAT",FALSE,"VAT Base Discount %");
            END ELSE BEGIN
              InvDiscBaseAmount := TempVATAmountLine1.GetTotalInvDiscBaseAmount(FALSE,"Currency Code");
              IF InvDiscBaseAmount = 0 THEN
                TempVATAmountLine2.SetInvoiceDiscountPercent(
                  0,"Currency Code","Prices Including VAT",FALSE,"VAT Base Discount %")
              ELSE
                TempVATAmountLine2.SetInvoiceDiscountPercent(
                  100 * TempVATAmountLine1.GetTotalInvDiscAmount / InvDiscBaseAmount,
                  "Currency Code","Prices Including VAT",FALSE,"VAT Base Discount %");
            END;
        END;

      UpdateHeaderInfo(1,TempVATAmountLine1);
      UpdateHeaderInfo(2,TempVATAmountLine2);

      IF ModifiedIndexNo = 1 THEN
        VATLinesForm.SetTempVATAmountLine(TempVATAmountLine1)
      ELSE
        VATLinesForm.SetTempVATAmountLine(TempVATAmountLine2);

      "Invoice Discount Calculation" := "Invoice Discount Calculation"::Amount;
      "Invoice Discount Value" := TotalPurchLine[1]."Inv. Discount Amount";
      MODIFY;
      UpdateVATOnPurchLines;
    END;

    LOCAL PROCEDURE UpdatePrepmtAmount@9();
    VAR
      TempPurchLine@1001 : TEMPORARY Record 39;
      PurchPostPrepmt@1000 : Codeunit 444;
    BEGIN
      PurchPostPrepmt.UpdatePrepmtAmountOnPurchLines(Rec,PrepmtTotalAmount);
      PurchPostPrepmt.GetPurchLines(Rec,0,TempPurchLine);
      PurchPostPrepmt.SumPrepmt(
        Rec,TempPurchLine,TempVATAmountLine4,PrepmtTotalAmount,PrepmtVATAmount,PrepmtVATAmountText);
      PrepmtInvPct :=
        Pct(TotalPurchLine[1]."Prepmt. Amt. Inv.",PrepmtTotalAmount);
      PrepmtDeductedPct :=
        Pct(TotalPurchLine[1]."Prepmt Amt Deducted",TotalPurchLine[1]."Prepmt. Amt. Inv.");
      IF "Prices Including VAT" THEN BEGIN
        PrepmtTotalAmount2 := PrepmtTotalAmount;
        PrepmtTotalAmount := PrepmtTotalAmount + PrepmtVATAmount;
      END ELSE
        PrepmtTotalAmount2 := PrepmtTotalAmount + PrepmtVATAmount;
      MODIFY;
    END;

    LOCAL PROCEDURE GetCaptionClass@2(FieldCaption@1000 : Text[100];ReverseCaption@1001 : Boolean) : Text[80];
    BEGIN
      IF "Prices Including VAT" XOR ReverseCaption THEN
        EXIT('2,1,' + FieldCaption);

      EXIT('2,0,' + FieldCaption);
    END;

    LOCAL PROCEDURE UpdateVATOnPurchLines@1();
    VAR
      PurchLine@1000 : Record 39;
    BEGIN
      GetVATSpecification(ActiveTab);
      IF TempVATAmountLine1.GetAnyLineModified THEN
        PurchLine.UpdateVATOnLines(0,Rec,PurchLine,TempVATAmountLine1);
      IF TempVATAmountLine2.GetAnyLineModified THEN
        PurchLine.UpdateVATOnLines(1,Rec,PurchLine,TempVATAmountLine2);
      PrevNo := '';
    END;

    LOCAL PROCEDURE VendInvDiscRecExists@4(InvDiscCode@1000 : Code[20]) : Boolean;
    VAR
      VendInvDisc@1001 : Record 24;
    BEGIN
      VendInvDisc.SETRANGE(Code,InvDiscCode);
      EXIT(VendInvDisc.FINDFIRST);
    END;

    LOCAL PROCEDURE CheckAllowInvDisc@8();
    VAR
      VendInvDisc@1000 : Record 24;
    BEGIN
      IF NOT AllowInvDisc THEN
        ERROR(
          Text005,
          VendInvDisc.TABLECAPTION,FIELDCAPTION("Invoice Disc. Code"),"Invoice Disc. Code");
    END;

    LOCAL PROCEDURE Pct@6(Numerator@1001 : Decimal;Denominator@1000 : Decimal) : Decimal;
    BEGIN
      IF Denominator = 0 THEN
        EXIT(0);
      EXIT(ROUND(Numerator / Denominator * 10000,1));
    END;

    LOCAL PROCEDURE VATLinesDrillDown@7(VAR VATLinesToDrillDown@1000 : Record 290;ThisTabAllowsVATEditing@1001 : Boolean);
    BEGIN
      CLEAR(VATLinesForm);
      VATLinesForm.SetTempVATAmountLine(VATLinesToDrillDown);
      VATLinesForm.InitGlobals(
        "Currency Code",AllowVATDifference,AllowVATDifference AND ThisTabAllowsVATEditing,
        "Prices Including VAT",AllowInvDisc,"VAT Base Discount %");
      VATLinesForm.RUNMODAL;
      VATLinesForm.GetTempVATAmountLine(VATLinesToDrillDown);
    END;

    [Integration]
    LOCAL PROCEDURE OnOpenPageOnBeforeSetEditable@10(VAR AllowInvDisc@1000 : Boolean;VAR AllowVATDifference@1001 : Boolean);
    BEGIN
    END;

    BEGIN
    END.
  }
}


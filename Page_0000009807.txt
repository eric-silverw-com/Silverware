OBJECT Page 9807 User Card
{
  OBJECT-PROPERTIES
  {
    Date=09/19/18;
    Time=12:00:00 PM;
    Version List=NAVW113.00;
  }
  PROPERTIES
  {
    CaptionML=[ENU=User Card;
               ESM=Ficha de usuario;
               FRC=Fiche utilisateur;
               ENC=User Card];
    SourceTable=Table2000000120;
    DataCaptionExpr="Full Name";
    DelayedInsert=Yes;
    PageType=Card;
    OnInit=BEGIN
             DeployedToAzure := IdentityManagement.IsAzure;
           END;

    OnOpenPage=VAR
                 PermissionManager@1000 : Codeunit 9002;
               BEGIN
                 SoftwareAsAService := PermissionManager.SoftwareAsAService;

                 HideExternalUsers;

                 IsWindowsClient := (ClientTypeManagement.GetCurrentClientType = CLIENTTYPE::Windows);

                 OnPremAskFirstUserToCreateSuper;
               END;

    OnAfterGetRecord=VAR
                       PermissionManager@1000 : Codeunit 9002;
                     BEGIN
                       WindowsUserName := IdentityManagement.UserName("Windows Security ID");

                       TESTFIELD("User Name");

                       Password := IdentityManagement.GetMaskedNavPassword("User Security ID");
                       ACSStatus := IdentityManagement.GetACSStatus("User Security ID");
                       WebServiceExpiryDate := IdentityManagement.GetWebServiceExpiryDate("User Security ID");
                       AuthenticationStatus := IdentityManagement.GetAuthenticationStatus("User Security ID");
                       HasExchangeIdentifier := "Exchange Identifier" <> '';
                       InitialState := State;

                       IF NOT ISNULLGUID("Application ID") THEN
                         ApplicationID := "Application ID";

                       IF PermissionManager.SoftwareAsAService AND (USERID <> "User Name") THEN BEGIN
                         AllowChangeWebServiceAccessKey := FALSE;
                         WebServiceID := '*************************************';
                       END ELSE BEGIN
                         AllowChangeWebServiceAccessKey := TRUE;
                         WebServiceID := IdentityManagement.GetWebServicesKey("User Security ID");
                       END;
                     END;

    OnNewRecord=BEGIN
                  IF NOT ManageUsersIsAllowed THEN
                    ERROR('');
                  WindowsUserName := '';
                  Password := '';
                  "Change Password" := FALSE;
                  WebServiceID := '';
                  CLEAR(WebServiceExpiryDate);
                END;

    OnInsertRecord=BEGIN
                     "User Security ID" := CREATEGUID;
                     TESTFIELD("User Name");
                   END;

    OnModifyRecord=BEGIN
                     TESTFIELD("User Name");
                   END;

    OnDeleteRecord=BEGIN
                     IF NOT ManageUsersIsAllowed THEN
                       ERROR('');
                   END;

    OnQueryClosePage=BEGIN
                       IF "User Name" <> '' THEN
                         EXIT(ValidateAuthentication);
                     END;

    ActionList=ACTIONS
    {
      { 10      ;    ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 9       ;1   ;ActionGroup;
                      CaptionML=[ENU=Authentication;
                                 ESM=Autenticaci¢n;
                                 FRC=Authentification;
                                 ENC=Authentication] }
      { 21      ;2   ;Action    ;
                      Name=AcsSetup;
                      CaptionML=[ENU=&ACS Setup;
                                 ESM=Configuraci¢n &ACS;
                                 FRC=Configuration &ACS;
                                 ENC=&ACS Setup];
                      ToolTipML=[ENU=Set up Access Control Service authentication, such as generating an authentication key that the user can use to connect to Azure.;
                                 ESM=Permite configurar la autenticaci¢n del Servicio de control de acceso (ACS), por ejemplo, la generaci¢n de una clave de autenticaci¢n que el usuario puede usar para conectarse a Azure.;
                                 FRC=Configurez l'authentification au service de contrìle d'accäs, par exemple la crÇation d'une clÇ d'authentification que l'utilisateur peut utiliser pour se connecter Ö Azure.;
                                 ENC=Set up Access Control Service authentication, such as generating an authentication key that the user can use to connect to Azure.];
                      ApplicationArea=#Basic,#Suite;
                      Promoted=Yes;
                      Visible=NOT SoftwareAsAService;
                      PromotedIsBig=Yes;
                      Image=ServiceSetup;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 EditACSStatus;
                               END;
                                }
      { 24      ;2   ;Action    ;
                      Name=ChangePassword;
                      CaptionML=[ENU=Change &Password;
                                 ESM=Cambiar &contrase§a;
                                 FRC=Changer le mot de &passe;
                                 ENC=Change &Password];
                      ToolTipML=[ENU=Change the user's password if the user connects using password authentication.;
                                 ESM=Permite cambiar la contrase§a del usuario si se conecta mediante autenticaci¢n de contrase§a.;
                                 FRC=Changez le mot de passe d'utilisateur si l'utilisateur se connecte Ö l'aide d'une authentification par mot de passe.;
                                 ENC=Change the user's password if the user connects using password authentication.];
                      ApplicationArea=#Basic,#Suite;
                      Promoted=Yes;
                      Visible=NOT SoftwareAsAService;
                      PromotedIsBig=Yes;
                      Image=EncryptionKeys;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 EditNavPassword;
                               END;
                                }
      { 20      ;2   ;Action    ;
                      Name=ChangeWebServiceAccessKey;
                      CaptionML=[ENU=Change &Web Service Key;
                                 ESM=Cambiar clave de servicio &Web;
                                 FRC=Modifier la clÇ de service &web;
                                 ENC=Change &Web Service Key];
                      ToolTipML=[ENU=Set up the key that web services use to access your data, and then specify the key on the user card for the relevant user accounts.;
                                 ESM=Permite configurar la clave que usan los servicios web para obtener acceso a sus datos, as° como especificar la clave en la ficha de usuario para las cuentas de usuario pertinentes.;
                                 FRC=Configurez la clÇ que les services Web utilisent pour accÇder Ö vos donnÇes, puis prÇcisez la clÇ sur la fiche utilisateur pour les comptes utilisateurs correspondants.;
                                 ENC=Set up the key that web services use to access your data, and then specify the key on the user card for the relevant user accounts.];
                      ApplicationArea=#Basic,#Suite;
                      Promoted=Yes;
                      Enabled=AllowChangeWebServiceAccessKey;
                      PromotedIsBig=Yes;
                      Image=ServiceCode;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 EditWebServiceID;
                               END;
                                }
      { 35      ;2   ;Action    ;
                      Name=DeleteExchangeIdentifier;
                      CaptionML=[ENU=Delete Exchange Identifier Mapping;
                                 ESM=Eliminar asignaci¢n de identificador de Exchange;
                                 FRC=Supprimer le mappage d'identificateurs Exchange;
                                 ENC=Delete Exchange Identifier Mapping];
                      ToolTipML=[ENU=Delete the document exchange mapping for the current user.;
                                 ESM=Permite eliminar la asignaci¢n de intercambio de documentos del usuario actual.;
                                 FRC=Supprimez le mappage d'Çchange de document pour l'utilisateur actuel.;
                                 ENC=Delete the document exchange mapping for the current user.];
                      ApplicationArea=#Basic,#Suite;
                      Enabled=HasExchangeIdentifier;
                      Image=DeleteXML;
                      OnAction=BEGIN
                                 IF NOT CONFIRM(ConfirmRemoveExchangeIdentifierQst) THEN
                                   EXIT;

                                 CLEAR("Exchange Identifier");
                                 MODIFY(TRUE);
                                 HasExchangeIdentifier := FALSE;
                               END;
                                }
      { 39      ;1   ;ActionGroup;
                      CaptionML=[ENU=Permissions;
                                 ESM=Permisos;
                                 FRC=Autorisations;
                                 ENC=Permissions] }
      { 37      ;2   ;Action    ;
                      CaptionML=[ENU=Effective Permissions;
                                 ESM=Permisos eficaces;
                                 FRC=Autorisations effectives;
                                 ENC=Effective Permissions];
                      ToolTipML=[ENU=View this user's actual permissions for all objects per assigned permission set, and edit the user's permissions in permission sets of type User-Defined.;
                                 ESM=Ver permisos reales de este usuario para todos los objetos por conjunto de permisos asignado, y editar los permisos del usuario en conjuntos de permisos de tipo Definido por el usuario.;
                                 FRC=Affichez les autorisations rÇelles de cet utilisateur pour tous les objets par ensemble d'autorisations affectÇ, puis modifiez les autorisations de l'utilisateur dans les ensembles d'autorisations de type DÇfini par l'utilisateur.;
                                 ENC=View this user's actual permissions for all objects per assigned permission set, and edit the user's permissions in permission sets of type User-Defined.];
                      ApplicationArea=#Basic,#Suite;
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Permission;
                      PromotedCategory=Process;
                      PromotedOnly=Yes;
                      OnAction=VAR
                                 EffectivePermissionsMgt@1000 : Codeunit 9852;
                               BEGIN
                                 EffectivePermissionsMgt.OpenPageForUser("User Security ID");
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1   ;0   ;Container ;
                ContainerType=ContentArea }

    { 2   ;1   ;Group     ;
                Name=General;
                CaptionML=[ENU=General;
                           ESM=General;
                           FRC=GÇnÇral;
                           ENC=General];
                GroupType=Group }

    { 3   ;2   ;Field     ;
                CaptionML=[ENU=User Security ID;
                           ESM=Id. de seguridad de usuario;
                           FRC=Code sÇcuritÇ utilisateur;
                           ENC=User Security ID];
                ToolTipML=[ENU=Specifies an ID that uniquely identifies the user. This value is generated automatically and should not be changed.;
                           ESM=Especifica un id. que identifique a un usuario de forma exclusiva. Este valor se genera autom†ticamente y no debe cambiarse.;
                           FRC=SpÇcifie un code qui identifie de maniäre unique l'utilisateur. Cette valeur est gÇnÇrÇe automatiquement et ne doit pas àtre modifiÇe.;
                           ENC=Specifies an ID that uniquely identifies the user. This value is generated automatically and should not be changed.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="User Security ID";
                Visible=FALSE }

    { 4   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the user's name. If the user is required to present credentials when starting the client, this is the name that the user must present.;
                           ESM=Especifica el nombre del usuario. Si se le pide al usuario que presente las credenciales al iniciar el cliente, este ser† el nombre que el usuario debe presentar.;
                           FRC=SpÇcifie le nom de l'utilisateur. Si l'utilisateur doit prÇsenter des informations d'identification lors du dÇmarrage du client, il s'agit du nom que l'utilisateur doit fournir.;
                           ENC=Specifies the user's name. If the user is required to present credentials when starting the client, this is the name that the user must present.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="User Name";
                Importance=Promoted;
                OnValidate=BEGIN
                             IF xRec."User Name" <> "User Name" THEN
                               ValidateUserName;
                           END;
                            }

    { 5   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the full name of the user.;
                           ESM=Especifica el nombre completo del usuario.;
                           FRC=SpÇcifie le nom complet de l'utilisateur.;
                           ENC=Specifies the full name of the user.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Full Name";
                Editable=NOT SoftwareAsAService }

    { 8   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the type of license that applies to the user.;
                           ESM=Especifica el tipo de licencia que se aplica al usuario.;
                           FRC=SpÇcifie le type de licence qui s'applique Ö l'utilisateur.;
                           ENC=Specifies the type of licence that applies to the user.];
                ApplicationArea=#All;
                SourceExpr="License Type";
                Visible=NOT SoftwareAsAService }

    { 6   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies if the user's login is enabled.;
                           ESM=Especifica si est† habilitado el inicio de sesi¢n del usuario.;
                           FRC=Indique si l'identifiant d'utilisateur est actif.;
                           ENC=Specifies if the user's login is enabled.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=State;
                Importance=Promoted }

    { 13  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies a date past which the user will no longer be authorized to log on to the Windows client.;
                           ESM=Especifica una fecha tras la cual el usuario dejar† de tener autorizaci¢n para iniciar sesi¢n en el cliente de Windows.;
                           FRC=Indique une date au-delÖ de laquelle l'utilisateur ne sera plus autorisÇ Ö se connecter au client Windows.;
                           ENC=Specifies a date past which the user will no longer be authorized to log on to the Windows client.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Expiry Date";
                Visible=NOT SoftwareAsAService }

    { 29  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the user's email address.;
                           ESM=Especifica la direcci¢n de correo electr¢nico del usuario.;
                           FRC=SpÇcifie l'adresse courriel de l'utilisateur.;
                           ENC=Specifies the user's email address.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Contact Email" }

    { 11  ;1   ;Group     ;
                Name=Windows Authentication;
                CaptionML=[ENU=Windows Authentication;
                           ESM=Autenticaci¢n Windows;
                           FRC=Authentification Windows;
                           ENC=Windows Authentication];
                Visible=(NOT DeployedToAzure) AND (NOT SoftwareAsAService);
                GroupType=Group }

    { 12  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the Windows Security ID of the user. This is only relevant for Windows authentication.;
                           ESM=Especifica el id. de seguridad de Windows del usuario. Esto es importante solo para la autenticaci¢n de Windows.;
                           FRC=SpÇcifie le code de sÇcuritÇ Windows de l'utilisateur. Il sert uniquement pour l'authentification Windows.;
                           ENC=Specifies the Windows Security ID of the user. This is only relevant for Windows authentication.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Windows Security ID";
                Visible=FALSE }

    { 38  ;2   ;Field     ;
                Name=Windows User Name;
                AssistEdit=No;
                CaptionML=[ENU=Windows User Name;
                           ESM=Nombre de usuario Windows;
                           FRC=Nom utilisateur Windows;
                           ENC=Windows User Name];
                ToolTipML=[ENU=Specifies the name of a valid Active Directory user, using the format domain\username.;
                           ESM=Especifica el nombre de un usuario v†lido de Active Directory, con el formato dominio\nombreDeUsuario.;
                           FRC=Indique le nom d'un utilisateur ActiveˇDirectory valide au format domaine\nom d'utilisateur.;
                           ENC=Specifies the name of a valid Active Directory user, using the format domain\username.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=WindowsUserName;
                Importance=Promoted;
                Visible=NOT IsWindowsClient;
                OnValidate=BEGIN
                             ValidateWindowsUserName;
                           END;
                            }

    { 7   ;2   ;Field     ;
                Name=Windows User Name Desktop;
                AssistEdit=Yes;
                CaptionML=[ENU=Windows User Name;
                           ESM=Nombre de usuario Windows;
                           FRC=Nom utilisateur Windows;
                           ENC=Windows User Name];
                ToolTipML=[ENU=Specifies the name of a valid Active Directory user, using the format domain\username.;
                           ESM=Especifica el nombre de un usuario v†lido de Active Directory, con el formato dominio\nombreDeUsuario.;
                           FRC=Indique le nom d'un utilisateur ActiveˇDirectory valide au format domaine\nom d'utilisateur.;
                           ENC=Specifies the name of a valid Active Directory user, using the format domain\username.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=WindowsUserName;
                Importance=Promoted;
                Visible=IsWindowsClient;
                OnValidate=BEGIN
                             ValidateWindowsUserName;
                           END;

                OnAssistEdit=VAR
                               DSOP@1000 : DotNet "'Microsoft.Dynamics.Nav.Management.DSObjectPickerWrapper, Version=13.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35'.Microsoft.Dynamics.Nav.Management.DSObjectPicker.DSObjectPickerWrapper" RUNONCLIENT;
                               result@1001 : Text;
                             BEGIN
                               DSOP := DSOP.DSObjectPickerWrapper;
                               result := DSOP.InvokeDialogAndReturnSid;
                               IF result <> '' THEN BEGIN
                                 "Windows Security ID" := result;
                                 ValidateSid;
                                 WindowsUserName := IdentityManagement.UserName("Windows Security ID");
                                 SetUserName;
                               END;
                             END;
                              }

    { 31  ;1   ;Group     ;
                Name=ACS Authentication;
                CaptionML=[ENU=Access Control Service Authentication;
                           ESM=Autenticaci¢n de Access Control Service;
                           FRC=Authentification Access Control Service;
                           ENC=Access Control Service Authentication];
                Visible=NOT SoftwareAsAService;
                GroupType=Group }

    { 22  ;2   ;Field     ;
                DrillDown=No;
                AssistEdit=Yes;
                CaptionML=[ENU=ACS Access Status;
                           ESM=Estado acceso ACS;
                           FRC=êtat accäs ACS;
                           ENC=ACS Access Status];
                ToolTipML=[ENU=Specifies the user's status for ACS authentication. When you start creating a user, the status is Disabled. After you create a user, the status changes to Pending. After the user logs on successfully, the status changes to Enabled.;
                           ESM=Especifica el estado del usuario para la autenticaci¢n del servicio ACS. Cuando inicia la creaci¢n de un usuario, el estado es Deshabilitado. DespuÇs de crear un usuario, el estado cambia a Pendiente. Una vez que el usuario inicia sesi¢n correctamente, el estado cambia a Habilitado.;
                           FRC=SpÇcifie l'Çtat de l'utilisateur pour l'authentification ACS. Lorsque vous commencez Ö crÇer un utilisateur, l'Çtat est DÇsactivÇ. Une fois l'utilisateur crÇÇ, l'Çtat passe Ö En cours. Une fois l'utilisateur connectÇ, l'Çtat devient Actif.;
                           ENC=Specifies the user's status for ACS authentication. When you start creating a user, the status is Disabled. After you create a user, the status changes to Pending. After the user logs on successfully, the status changes to Enabled.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=ACSStatus;
                Importance=Promoted;
                Visible=NOT SoftwareAsAService;
                Editable=FALSE;
                OnAssistEdit=BEGIN
                               EditACSStatus;
                             END;
                              }

    { 15  ;1   ;Group     ;
                Name=NAV Password Authentication;
                CaptionML=[ENU=Business Central Password Authentication;
                           ESM=Autenticaci¢n de contrase§a de Business Central;
                           FRC=Authentification mot de passe Business Central;
                           ENC=Business Central Password Authentication];
                Visible=NOT SoftwareAsAService;
                GroupType=Group }

    { 25  ;2   ;Field     ;
                ExtendedDatatype=Masked;
                AssistEdit=Yes;
                CaptionML=[ENU=Password;
                           ESM=Contrase§a;
                           FRC=Mot de passe;
                           ENC=Password];
                ToolTipML=[ENU=Specifies an initial password for the user. To sign in to the client, the user must provide the name that is specified in the User Name field and this password.;
                           ESM=Especifica una contrase§a inicial para el usuario. Para iniciar sesi¢n en el cliente, el usuario debe proporcionar el nombre especificado en el campo Nombre de usuario y esta contrase§a.;
                           FRC=SpÇcifie un mot de passe initial pour l'utilisateur. Pour se connecter au client, l'utilisateur doit fournir le nom spÇcifiÇ dans le champ Nom d'utilisateur et ce mot de passe.;
                           ENC=Specifies an initial password for the user. To sign in to the client, the user must provide the name that is specified in the User Name field and this password.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=Password;
                Importance=Standard;
                Editable=FALSE;
                OnAssistEdit=BEGIN
                               EditNavPassword;
                             END;
                              }

    { 26  ;2   ;Field     ;
                CaptionML=[ENU=User must change password at next login;
                           ESM=El usuario debe cambiar la contrase§a en el pr¢ximo inicio de sesi¢n;
                           FRC=L'utilisateur doit modifier le mot de passe lors de sa prochaine connexion;
                           ENC=User must change password at next login];
                ToolTipML=[ENU=Specifies if the user will be prompted to change the password at next login.;
                           ESM=Especifica si se pedir† al usuario que modifique la contrase§a en el pr¢ximo inicio de sesi¢n.;
                           FRC=Indique si l'utilisateur va àtre invitÇ Ö modifier le mot de passe Ö l'ouverture de la prochaine session.;
                           ENC=Specifies if the user will be prompted to change the password at next login.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Change Password" }

    { 19  ;1   ;Group     ;
                Name=Web Service Access;
                CaptionML=[ENU=Web Service Access;
                           ESM=Acceso servicio web;
                           FRC=Accäs service web;
                           ENC=Web Service Access];
                GroupType=Group }

    { 23  ;2   ;Field     ;
                AssistEdit=Yes;
                CaptionML=[ENU=Web Service Access Key;
                           ESM=Clave acceso servicio web;
                           FRC=ClÇ d'accäs service web;
                           ENC=Web Service Access Key];
                ToolTipML=[ENU=Specifies a generated key that Dynamics 365 web service applications can use to authenticate to Dynamics 365 services. Choose the AssistEdit button to generate a key.;
                           ESM=Especifica una clave generada que las aplicaciones de servicio web de Dynamics 365 pueden usar para la autenticaci¢n de los servicios de Dynamicsˇ365. Elija el bot¢n AssistEdit para generar una clave.;
                           FRC=SpÇcifie une clÇ gÇnÇrÇe que les applications de service Web Dynamicsˇ365 peuvent utiliser pour s'authentifier aupräs des services Dynamicsˇ365. SÇlectionnez le bouton AssistEdit pour gÇnÇrer une clÇ.;
                           ENC=Specifies a generated key that Dynamics 365 web service applications can use to authenticate to Dynamics 365 services. Choose the AssistEdit button to generate a key.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=WebServiceID;
                Editable=FALSE;
                OnAssistEdit=BEGIN
                               EditWebServiceID;
                             END;
                              }

    { 30  ;2   ;Field     ;
                CaptionML=[ENU=Web Service Expiry Date;
                           ESM=Fecha expiraci¢n servicio web;
                           FRC=Date d'expiration service web;
                           ENC=Web Service Expiry Date];
                ToolTipML=[ENU=Specifies an expiration date for the web services access key.;
                           ESM=Especifica una fecha de caducidad para la clave de acceso de los servicios web.;
                           FRC=Indique une date d'expiration pour la touche d'accäs rapide des servicesˇWeb.;
                           ENC=Specifies an expiration date for the web services access key.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=WebServiceExpiryDate;
                Importance=Promoted;
                Editable=FALSE }

    { 27  ;1   ;Group     ;
                Name=Office 365 Authentication;
                CaptionML=[@@@="{Locked=""Office 365""}";
                           ENU=Office 365 Authentication;
                           ESM=Autenticaci¢n de Office 365;
                           FRC=Authentification Office 365;
                           ENC=Office 365 Authentication];
                GroupType=Group }

    { 28  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the Microsoft account that this user signs into Office 365 or SharePoint Online with.;
                           ESM=Especifica la cuenta de Microsoft con la que este usuario inicia sesi¢n en Office 365 o SharePoint Online.;
                           FRC=SpÇcifie le compte Microsoft avec lequel cet utilisateur se connecte Ö Officeˇ365 ou SharePoint Online.;
                           ENC=Specifies the Microsoft account that this user signs into Office 365 or SharePoint Online with.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Authentication Email";
                Editable=NOT SoftwareAsAService;
                OnValidate=BEGIN
                             IdentityManagement.SetAuthenticationEmail("User Security ID","Authentication Email");
                             CurrPage.SAVERECORD;
                             AuthenticationStatus := IdentityManagement.GetAuthenticationStatus("User Security ID");
                           END;
                            }

    { 36  ;2   ;Field     ;
                Name=ApplicationID;
                CaptionML=[ENU=Application ID;
                           ESM=Id. aplicaci¢n;
                           FRC=Code d'application;
                           ENC=Application ID];
                ToolTipML=[ENU=Specifies the client ID of the Microsoft Azure Active Directory application when authenticating web-service calls. This field is only relevant when the Business Central user is used for web services.;
                           ESM=Especifica el identificador de cliente de la aplicaci¢n Microsoft Azure Active Directory al autenticar llamadas a servicios web. Este campo solo es importante cuando se utiliza el usuario de Business Central para los servicios web.;
                           FRC=SpÇcifie le code client de l'application Microsoft Azure Active Directory lors de l'authentification des appels du service Web. Ce champ est pertinent uniquement lorsque l'utilisateur Business Central est utilisÇ pour les services Web.;
                           ENC=Specifies the client ID of the Microsoft Azure Active Directory application when authenticating web-service calls. This field is only relevant when the Business Central user is used for web services.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=ApplicationID;
                Visible=NOT SoftwareAsAService;
                OnValidate=VAR
                             ZeroGUID@1000 : GUID;
                           BEGIN
                             IF ApplicationID = '' THEN
                               VALIDATE("Application ID",ZeroGUID)
                             ELSE
                               VALIDATE("Application ID",ApplicationID);
                           END;
                            }

    { 34  ;2   ;Field     ;
                Name=MappedToExchangeIdentifier;
                CaptionML=[ENU=Mapped To Exchange Identifier;
                           ESM=Asignado a identificador de Exchange;
                           FRC=MappÇ Ö l'identificateur Exchange;
                           ENC=Mapped To Exchange Identifier];
                ToolTipML=[ENU=Specifies whether the user is mapped to a Microsoft Exchange identifier, which enables the user to access Business Central from Exchange applications (such as Outlook) without having to sign-in.;
                           ESM=Especifica si un usuario est† asignado a un identificador de Microsoft Exchange, lo que permite al usuario tener acceso a Business Central desde aplicaciones de Exchange (por ejemplo, Outlook) sin necesidad de iniciar sesi¢n.;
                           FRC=SpÇcifie si l'utilisateur est mappÇ Ö un identificateur Microsoft Exchange, ce qui lui permet d'accÇder Ö Business Central Ö partir d'applications Exchange (comme Outlook), sans avoir Ö se connecter.;
                           ENC=Specifies whether the user is mapped to a Microsoft Exchange identifier, which enables the user to access Business Central from Exchange applications (such as Outlook) without having to sign-in.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=HasExchangeIdentifier;
                Editable=FALSE;
                Style=StandardAccent;
                StyleExpr=TRUE }

    { 32  ;2   ;Field     ;
                Name=AuthenticationStatus;
                CaptionML=[ENU=Authentication Status;
                           ESM=Estado de autenticaci¢n;
                           FRC=êtat d'authentification;
                           ENC=Authentication Status];
                ToolTipML=[ENU=Specifies the user's status for Office 365 authentication. When you start to create a user, the status is Disabled. After you specify an authentication email address for the user, the status changes to Inactive. After the user logs on successfully, the status changes to Active.;
                           ESM=Especifica el estado del usuario para la autenticaci¢n de Office 365. Cuando inicia la creaci¢n de un usuario, el estado es Deshabilitado. DespuÇs de especificar una direcci¢n de correo electr¢nico de autenticaci¢n para el usuario, el estado cambia a Inactivo. Una vez que el usuario inicia sesi¢n correctamente, el estado cambia a Activo.;
                           FRC=SpÇcifie l'Çtat de l'utilisateur pour l'authentification Officeˇ365. Lorsque vous commencez Ö crÇer un utilisateur, l'Çtat est DÇsactivÇ. Une fois que vous avez spÇcifiÇ une adresse Çlectronique d'authentification pour l'utilisateur, l'Çtat devient Inactif. Une fois l'utilisateur connectÇ, l'Çtat passe sur Actif.;
                           ENC=Specifies the user's status for Office 365 authentication. When you start to create a user, the status is Disabled. After you specify an authentication email address for the user, the status changes to Inactive. After the user logs on successfully, the status changes to Active.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=AuthenticationStatus;
                Editable=FALSE }

    { 33  ;1   ;Part      ;
                Name=UserGroups;
                CaptionML=[ENU=User Groups;
                           ESM=Grupos de usuarios;
                           FRC=Groupes d'utilisateurs;
                           ENC=User Groups];
                ApplicationArea=#Basic,#Suite;
                SubPageLink=User Security ID=FIELD(User Security ID);
                PagePartID=Page9833;
                PartType=Page;
                UpdatePropagation=Both }

    { 14  ;1   ;Part      ;
                Name=Permissions;
                CaptionML=[ENU=User Permission Sets;
                           ESM=Conjuntos de permisos de usuario;
                           FRC=Ensembles d'autorisations utilisateur;
                           ENC=User Permission Sets];
                ApplicationArea=#Basic,#Suite;
                SubPageLink=User Security ID=FIELD(User Security ID);
                PagePartID=Page9801;
                PartType=Page }

    { 16  ;    ;Container ;
                ContainerType=FactBoxArea }

    { 17  ;1   ;Part      ;
                PartType=System;
                SystemPartID=Notes }

    { 18  ;1   ;Part      ;
                PartType=System;
                SystemPartID=RecordLinks }

  }
  CODE
  {
    VAR
      UserSecID@1007 : Record 2000000120;
      IdentityManagement@1011 : Codeunit 9801;
      ClientTypeManagement@1077 : Codeunit 4;
      WindowsUserName@1000 : Text[208];
      Text001@1003 : TextConst 'ENU=The account %1 is not a valid Windows account.;ESM=La cuenta %1 no es una cuenta Windows v†lida.;FRC=%1 n''est pas un compte Windows valide.;ENC=The account %1 is not a valid Windows account.';
      Text002@1002 : TextConst 'ENU=The account %1 already exists.;ESM=La cuenta %1 ya existe.;FRC=Le compte %1 existe dÇjÖ.;ENC=The account %1 already exists.';
      Text003@1001 : TextConst 'ENU=The account %1 is not allowed.;ESM=La cuenta %1 no se permite.;FRC=Le compte %1 n''est pas autorisÇ.;ENC=The account %1 is not allowed.';
      Password@1006 : Text[80];
      ACSStatus@1008 : 'Disabled,Pending,Registered,Unknown';
      WebServiceID@1009 : Text[80];
      Confirm001Qst@1010 : TextConst 'ENU=The current Web Service Access Key will not be valid after editing. All clients that use it have to be updated. Do you want to continue?;ESM=La clave de acceso al servicio web dejar† de ser v†lida despuÇs de la modificaci¢n. Se deber†n actualizar todos los clientes que la usaron. ®Desea continuar?;FRC=La clÇ d''accäs au service web actuelle ne sera plus valide apräs modification. Tous les clients qui l''utilisent doivent àtre mis Ö jour. Voulez-vous continuer?;ENC=The current Web Service Access Key will not be valid after editing. All clients that use it have to be updated. Do you want to continue?';
      WebServiceExpiryDate@1012 : DateTime;
      Confirm002Qst@1013 : TextConst 'ENU=You have not completed all necessary fields for the Credential Type that this client is currently using. The user will not be able to log in unless you provide a value in the %1 field. Are you sure that you want to close the window?;ESM=No ha rellenado todos los campos necesarios para el tipo de credencial que este cliente est† usando actualmente. El usuario no podr† iniciar sesi¢n a menos que proporcione un valor en el campo %1. ®Est†s seguro de que desea cerrar la ventana?;FRC=Vous n''avez pas renseignÇ tous les champs nÇcessaires pour le Type d''informations d''identification actuellement utilisÇ par ce client. L''utilisateur ne pourra pas se connecter, Ö moins que vous indiquiez une valeur dans le champ %1. Voulez-vous vraiment fermer la fenàtre?;ENC=You have not completed all necessary fields for the Credential Type that this client is currently using. The user will not be able to log in unless you provide a value in the %1 field. Are you sure that you want to close the window?';
      DeployedToAzure@1014 : Boolean INDATASET;
      Confirm003Qst@1005 : TextConst 'ENU=The user will not be able to sign in unless you change the state to Enabled. Are you sure that you want to close the page?;ESM=El usuario no podr† iniciar sesi¢n a menos que cambie el estado a Activado. ®Est† seguro de que desea cerrar la p†gina?;FRC=L''utilisateur ne pourra pas se connecter, Ö moins que vous modifiiez l''Çtat en ActivÇ. Voulez-vous vraiment fermer la page?;ENC=The user will not be able to sign in unless you change the state to Enabled. Are you sure that you want to close the page?';
      HasExchangeIdentifier@1016 : Boolean;
      AuthenticationStatus@1004 : 'Disabled,Inactive,Active';
      Confirm004Qst@1015 : TextConst 'ENU=The user will not be able to sign in because no authentication data was provided. Are you sure that you want to close the page?;ESM=El usuario no podr† iniciar sesi¢n porque no se proporcionaron datos de autenticaci¢n. ®Est† seguro de que desea cerrar la p†gina?;FRC=L''utilisateur ne pourra pas se connecter, car aucune donnÇe d''authentification n''a ÇtÇ fournie. Voulez-vous vraiment fermer la page?;ENC=The user will not be able to sign in because no authentication data was provided. Are you sure that you want to close the page?';
      ConfirmRemoveExchangeIdentifierQst@1017 : TextConst 'ENU=If you delete the Exchange Identifier Mapping, the user will no longer automatically be signed in when they use Exchange applications.\Do you want to continue?;ESM=Si elimina la asignaci¢n del identificador de Exchange, la sesi¢n del usuario ya no se iniciar† autom†ticamente al usar aplicaciones de Exchange.\®Quiere continuar?;FRC=Si vous supprimez le mappage d''identificateurs Exchange, l''utilisateur n''est plus connectÇ automatiquement lors de l''utilisation d''applications Exchange.\Souhaitez-vous continuerˇ?;ENC=If you delete the Exchange Identifier Mapping, the user will no longer automatically be signed in when they use Exchange applications.\Do you want to continue?';
      SoftwareAsAService@1018 : Boolean;
      ApplicationID@1019 : Text;
      CannotManageUsersQst@1029 : TextConst 'ENU=You cannot add or delete users on this page. Administrators can manage users in the Office 365 admin center.\\Do you want to go there now?;ESM=No puede agregar ni eliminar usuarios de esta p†gina. Los administradores pueden administrar usuarios en el centro de administraci¢n de Office 365.\\®Desea obtener acceso ahora?;FRC=Vous ne pouvez ni ajouter ni supprimer d''utilisateurs sur cette page. Les administrateurs peuvent gÇrer les utilisateurs dans le centre d''administration Office 365.\\Souhaitez-vous l''ouvrir maintenantˇ?;ENC=You cannot add or delete users on this page. Administrators can manage users in the Office 365 admin centre.\\Do you want to go there now?';
      AllowChangeWebServiceAccessKey@1021 : Boolean;
      IsWindowsClient@1024 : Boolean;
      InitialState@1023 : Option;
      CreateFirstUserQst@1025 : TextConst '@@@=USERID;ENU=You will be locked out after creating first user. Would you first like to create a SUPER user for %1?;ESM=Se le bloquear† tras crear el primer usuario. ®Desea crear primero un superusuario para %1?;FRC=Vous serez verrouillÇ apräs avoir crÇÇ le premier utilisateur. Souhaitez-vous tout d''abord crÇer un SUPER utilisateur pour %1ˇ?;ENC=You will be locked out after creating first user. Would you first like to create a SUPER user for %1?';
      CreateFirstUserYesMsg@1026 : TextConst 'ENU=Yes;ESM=S°;FRC=Oui;ENC=Yes';
      CreateFirstUserNoMsg@1027 : TextConst 'ENU=No;ESM=N.ß;FRC=Non;ENC=No';
      OfficePortalTxt@1022 : TextConst '@@@={Locked};ENU="https://go.microsoft.com/fwlink/?linkid=844936";ESM="https://go.microsoft.com/fwlink/?linkid=844936";FRC="https://go.microsoft.com/fwlink/?linkid=844936";ENC="https://go.microsoft.com/fwlink/?linkid=844936"';
      OfficePPEPortalTxt@1020 : TextConst '@@@={Locked};ENU="https://go.microsoft.com/fwlink/?linkid=844935";ESM="https://go.microsoft.com/fwlink/?linkid=844935";FRC="https://go.microsoft.com/fwlink/?linkid=844935";ENC="https://go.microsoft.com/fwlink/?linkid=844935"';

    LOCAL PROCEDURE ValidateSid@1();
    VAR
      User@1000 : Record 2000000120;
    BEGIN
      IF "Windows Security ID" = '' THEN
        ERROR(Text001,"User Name");

      IF ("Windows Security ID" = 'S-1-1-0') OR ("Windows Security ID" = 'S-1-5-7') OR ("Windows Security ID" = 'S-1-5-32-544') THEN
        ERROR(Text003,IdentityManagement.UserName("Windows Security ID"));

      User.SETFILTER("Windows Security ID","Windows Security ID");
      User.SETFILTER("User Security ID",'<>%1',"User Security ID");
      IF NOT User.ISEMPTY THEN
        ERROR(Text002,User."User Name");
    END;

    LOCAL PROCEDURE ValidateAuthentication@7() : Boolean;
    VAR
      ValidationField@1000 : Text;
    BEGIN
      UserSecID.RESET;
      IF (UserSecID.COUNT = 1) OR (USERSECURITYID = "User Security ID") THEN BEGIN
        IF IdentityManagement.IsWindowsAuthentication AND ("Windows Security ID" = '') THEN
          ValidationField := 'Windows User Name';

        IF IdentityManagement.IsUserNamePasswordAuthentication AND (Password = '') THEN
          ValidationField := 'Password';

        IF IdentityManagement.IsAccessControlServiceAuthentication AND (ACSStatus = 0) AND (AuthenticationStatus = 0) THEN
          ValidationField := 'ACSStatus / AuthenticationStatus';

        IF ValidationField <> '' THEN
          EXIT(CONFIRM(Confirm002Qst,FALSE,ValidationField));
      END ELSE BEGIN
        IF ("Windows Security ID" = '') AND (Password = '') AND (ACSStatus = 0) AND (AuthenticationStatus = 0) THEN
          EXIT(CONFIRM(Confirm004Qst,FALSE));
      END;

      IF (InitialState = State::Enabled) AND (State = State::Disabled) THEN
        EXIT(CONFIRM(Confirm003Qst,FALSE));

      EXIT(TRUE);
    END;

    LOCAL PROCEDURE ValidateUserName@3();
    VAR
      UserMgt@1000 : Codeunit 418;
    BEGIN
      UserMgt.ValidateUserName(Rec,xRec,WindowsUserName);
      CurrPage.UPDATE;
    END;

    LOCAL PROCEDURE EditWebServiceID@6();
    VAR
      PermissionManager@1001 : Codeunit 9002;
      SetWebServiceAccessKey@1000 : Page 9812;
    BEGIN
      IF PermissionManager.SoftwareAsAService AND (USERSECURITYID <> "User Security ID") THEN
        EXIT;

      TESTFIELD("User Name");

      IF CONFIRM(Confirm001Qst) THEN BEGIN
        UserSecID.SETCURRENTKEY("User Security ID");
        UserSecID.SETRANGE("User Security ID","User Security ID","User Security ID");
        SetWebServiceAccessKey.SETRECORD(UserSecID);
        SetWebServiceAccessKey.SETTABLEVIEW(UserSecID);
        IF SetWebServiceAccessKey.RUNMODAL = ACTION::OK THEN
          CurrPage.UPDATE;
      END;
    END;

    LOCAL PROCEDURE EditNavPassword@8();
    VAR
      SetPassword@1000 : Page 9810;
    BEGIN
      TESTFIELD("User Name");

      CurrPage.SAVERECORD;
      COMMIT;

      UserSecID.SETCURRENTKEY("User Security ID");
      UserSecID.SETRANGE("User Security ID","User Security ID","User Security ID");
      SetPassword.SETRECORD(UserSecID);
      SetPassword.SETTABLEVIEW(UserSecID);
      IF SetPassword.RUNMODAL = ACTION::OK THEN
        CurrPage.UPDATE(FALSE);
    END;

    LOCAL PROCEDURE EditACSStatus@9();
    VAR
      UserACSSetup@1000 : Page 9811;
    BEGIN
      TESTFIELD("User Name");

      UserSecID.SETCURRENTKEY("User Security ID");
      UserSecID.SETRANGE("User Security ID","User Security ID","User Security ID");
      UserACSSetup.SETRECORD(UserSecID);
      UserACSSetup.SETTABLEVIEW(UserSecID);
      IF UserACSSetup.RUNMODAL = ACTION::OK THEN
        CurrPage.UPDATE;
    END;

    [External]
    PROCEDURE ManageUsersIsAllowed@11() : Boolean;
    VAR
      PermissionManager@1000 : Codeunit 9002;
      EnvironmentMgt@1001 : Codeunit 9005;
    BEGIN
      IF NOT PermissionManager.SoftwareAsAService THEN
        EXIT(TRUE);

      IF CONFIRM(CannotManageUsersQst,TRUE) THEN
        IF EnvironmentMgt.IsPPE THEN
          HYPERLINK(OfficePPEPortalTxt)
        ELSE
          HYPERLINK(OfficePortalTxt);

      EXIT(FALSE);
    END;

    LOCAL PROCEDURE SetUserName@4();
    BEGIN
      "User Name" := WindowsUserName;
      ValidateUserName;
    END;

    LOCAL PROCEDURE HideExternalUsers@2();
    VAR
      PermissionManager@1001 : Codeunit 9002;
      OriginalFilterGroup@1000 : Integer;
    BEGIN
      IF NOT PermissionManager.SoftwareAsAService THEN
        EXIT;

      OriginalFilterGroup := FILTERGROUP;
      FILTERGROUP := 2;
      SETFILTER("License Type",'<>%1',"License Type"::"External User");
      FILTERGROUP := OriginalFilterGroup;
    END;

    LOCAL PROCEDURE ValidateWindowsUserName@5();
    VAR
      UserSID@1001 : Text;
    BEGIN
      IF WindowsUserName = '' THEN
        "Windows Security ID" := ''
      ELSE BEGIN
        UserSID := SID(WindowsUserName);
        WindowsUserName := IdentityManagement.UserName(UserSID);
        IF WindowsUserName <> '' THEN BEGIN
          "Windows Security ID" := UserSID;
          ValidateSid;
          SetUserName;
        END ELSE
          ERROR(Text001,WindowsUserName);
      END;
    END;

    LOCAL PROCEDURE OnPremAskFirstUserToCreateSuper@10();
    VAR
      User@1001 : Record 2000000120;
      FormatedMessage@1002 : Text;
    BEGIN
      IF SoftwareAsAService THEN
        EXIT;

      // Users already exist
      IF NOT User.ISEMPTY THEN
        EXIT;

      // Copy localized message to a variable to bypass
      // Bug 195060: Argument size problem in CONFIRM function when using place holders in localized message
      FormatedMessage := CreateFirstUserQst;
      IF CONFIRM(FormatedMessage,TRUE,USERID,CreateFirstUserYesMsg,CreateFirstUserNoMsg) THEN
        CODEUNIT.RUN(CODEUNIT::"Users - Create Super User");
    END;

    BEGIN
    END.
  }
}

